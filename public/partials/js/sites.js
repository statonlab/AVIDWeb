(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{"Mn/S":function(t,e,a){"use strict";a.r(e);var s={name:"Sites",components:{SitesDataView:a("Y3if").a}},n=a("KHd+"),r=Object(n.a)(s,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("h1",{staticClass:"page-title mb-3"},[this._v("Sites")]),this._v(" "),e("sites-data-view")],1)}),[],!1,null,"06516722",null);e.default=r.exports},Y3if:function(t,e,a){"use strict";var s=a("o0o1"),n=a.n(s),r=a("yJCx"),i=a("TTxJ"),o=a("uHij"),l=a("cv7c"),c=a("+Gql"),u=a("wd/R"),d=a.n(u);function p(t,e,a,s,n,r,i){try{var o=t[r](i),l=o.value}catch(t){return void a(t)}o.done?e(l):Promise.resolve(l).then(s,n)}function h(t){return function(){var e=this,a=arguments;return new Promise((function(s,n){var r=t.apply(e,a);function i(t){p(r,s,n,i,o,"next",t)}function o(t){p(r,s,n,i,o,"throw",t)}i(void 0)}))}}var v={name:"SitesDataView",components:{Pager:r.a,InlineSpinner:i.a,SiteForm:o.a,Icon:l.a},props:{url:{required:!1,type:String,default:"/web/sites"},editable:{required:!1,type:Boolean,default:!1},showOwner:{required:!1,type:Boolean,default:!1},siteUrlPrefix:{required:!1,type:String,default:"/app/sites"},unauthorizedMessage:{required:!1,type:String,default:"You do not have permission to view sites."}},data:function(){return{moment:d.a,User:c.a,showSiteForm:!1,sites:[],loading:!1,page:1,lastPage:1,total:0,site:null,deleting:null,search:"",_request:null,orderBy:"last_measured_at",orderDir:"desc",unauthorized:!1}},mounted:function(){this.loading=!0,this.loadSites()},watch:{search:function(){this.page=1,this.loadSites()}},methods:{loadSites:function(){var t=this;return h(n.a.mark((function e(){var a,s;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t._request&&t._request(),e.prev=1,e.next=4,axios.get(t.url,{params:{search:t.search,page:t.page,order_by:t.orderBy,order_dir:t.orderDir},cancelToken:new axios.CancelToken((function(e){return t._request=e}))});case 4:a=e.sent,s=a.data,t.total=s.total,t.sites=s.data,t.lastPage=s.last_page,t.loading=!1,t.$emit("load",s),e.next=21;break;case 13:if(e.prev=13,e.t0=e.catch(1),axios.isCancel(e.t0)){e.next=21;break}if(t.loading=!1,!e.t0.response||403!==e.t0.response.status){e.next=20;break}return t.unauthorized=!0,e.abrupt("return");case 20:console.error(e.t0);case 21:case"end":return e.stop()}}),e,null,[[1,13]])})))()},siteCreated:function(){this.loadSites(),this.closeForm()},siteUpdated:function(t){this.sites=this.sites.map((function(e){return e.id===t.id?t:e})),this.closeForm()},closeForm:function(){this.site=null,this.showSiteForm=!1},edit:function(t){this.site=t,this.showSiteForm=!0},destroy:function(t){var e,a=this;this.$confirm({title:"Are you sure you want to delete ".concat(t.name,"?"),text:"This action is permanent!",onConfirm:(e=h(n.a.mark((function e(){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.deleting=t.id,e.prev=1,e.next=4,axios.delete("/web/sites/".concat(t.id));case 4:return e.next=6,a.loadSites();case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),a.$notify({text:"Unable to delete site. Please try refreshing the page.",type:"error"});case 11:a.deleting=null;case 12:case"end":return e.stop()}}),e,null,[[1,8]])}))),function(){return e.apply(this,arguments)})})},goTo:function(t){this.page=t,this.loadSites()},sort:function(t){t===this.orderBy?this.orderDir="asc"===this.orderDir?"desc":"asc":(this.orderBy=t,this.orderDir="asc"),this.loadSites()},sortIcon:function(t){return t!==this.orderBy?"swap-vertical":"asc"===this.orderDir?"arrow-up":"arrow-down"}}},f=a("KHd+"),m=Object(f.a)(v,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"card mb-3"},[a("div",{staticClass:"card-header d-flex p-2"},[a("div",{staticClass:"flex-grow-1"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.search,expression:"search"}],staticClass:"form-control",attrs:{type:"search",placeholder:"Search..."},domProps:{value:t.search},on:{input:function(e){e.target.composing||(t.search=e.target.value)}}})]),t._v(" "),a("div",{staticClass:"ml-auto flex-shrink-0 pl-1"},[a("button",{staticClass:"btn btn-primary",on:{click:function(e){e.preventDefault(),t.showSiteForm=!0}}},[a("icon",{attrs:{name:"add"}}),t._v(" "),a("span",[t._v("New Site")])],1)])]),t._v(" "),a("div",{staticClass:"card-body p-0 table-responsive"},[t.loading?a("p",{staticClass:"mb-0 p-4"},[a("inline-spinner",{staticClass:"text-primary"})],1):t._e(),t._v(" "),t.unauthorized?a("p",{staticClass:"mb-0 p-4 text-muted"},[t._v("\n                "+t._s(t.unauthorizedMessage)+"\n            ")]):t._e(),t._v(" "),t.loading||0!==t.sites.length||t.unauthorized?t._e():a("p",{staticClass:"mb-0 p-4 text-muted"},[t._v('\n                No results found. Use the "New Site" button above to create a new one.\n            ')]),t._v(" "),!t.loading&&t.sites.length>0&&!t.unauthorized?a("table",{staticClass:"table mb-0 table-middle table-hover table-nowrap"},[a("thead",[a("tr",[a("th",[a("a",{staticClass:"d-flex align-items-center",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.sort("name")}}},[a("span",{staticClass:"mr-1"},[t._v("Name")]),t._v(" "),a("icon",{attrs:{name:t.sortIcon("name")}})],1)]),t._v(" "),t.showOwner?a("th",[t._v("\n                        Created By\n                    ")]):t._e(),t._v(" "),a("th",[a("a",{staticClass:"d-flex align-items-center",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.sort("plots_count")}}},[a("span",{staticClass:"mr-1"},[t._v("Plots")]),t._v(" "),a("icon",{attrs:{name:t.sortIcon("plots_count")}})],1)]),t._v(" "),a("th",[a("a",{staticClass:"d-flex align-items-center",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.sort("plants_count")}}},[a("span",{staticClass:"mr-1"},[t._v("Plants")]),t._v(" "),a("icon",{attrs:{name:t.sortIcon("plants_count")}})],1)]),t._v(" "),a("th",[a("a",{staticClass:"d-flex align-items-center",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.sort("last_measured_at")}}},[a("span",{staticClass:"mr-1"},[t._v("Last Measured")]),t._v(" "),a("icon",{attrs:{name:t.sortIcon("last_measured_at")}})],1)]),t._v(" "),a("th")])]),t._v(" "),a("tbody",t._l(t.sites,(function(e){return a("tr",{class:{"on-hover":t.deleting!==e.id}},[a("td",[a("router-link",{attrs:{to:t.siteUrlPrefix+"/"+e.id}},[a("strong",[t._v(t._s(e.name))])]),t._v(" "),a("div",{staticClass:"text-muted"},[t._v("\n                            "+t._s(e.county.name)+", "+t._s(e.state.code)+"\n                        ")])],1),t._v(" "),t.showOwner?a("td",[t._v(t._s(e.user.name))]):t._e(),t._v(" "),a("td",[t._v(t._s(t._f("plural")(e.plots_count,"Plot","Plots")))]),t._v(" "),a("td",[t._v(t._s(t._f("plural")(e.plants_count,"Plant","Plants")))]),t._v(" "),a("td",[e.last_measured_at?a("span",[t._v("\n                            "+t._s(t.moment(e.last_measured_at).format("MMM Do, YYYY"))+"\n                        ")]):t._e()]),t._v(" "),a("td",{staticClass:"text-right no-wrap"},[a("router-link",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"View Plots",expression:"'View Plots'"}],staticClass:"show-on-hover btn btn-link btn-sm",attrs:{to:t.siteUrlPrefix+"/"+e.id}},[a("icon",{attrs:{name:"eye"}})],1),t._v(" "),t.editable||t.User.owns(e)||t.User.can("delete sites")?a("button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"Edit Site",expression:"'Edit Site'"}],staticClass:"show-on-hover btn btn-link btn-sm mr-1",on:{click:function(a){return a.preventDefault(),t.edit(e)}}},[a("icon",{attrs:{name:"create"}})],1):t._e(),t._v(" "),t.User.owns(e)||t.User.can("delete sites")?a("button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"Delete Site",expression:"'Delete Site'"}],staticClass:"show-on-hover btn btn-link btn-sm",on:{click:function(a){return a.preventDefault(),t.destroy(e)}}},[t.deleting!==e.id?a("icon",{attrs:{name:"trash"}}):a("inline-spinner",{staticClass:"text-primary"})],1):t._e()],1)])})),0)]):t._e()])]),t._v(" "),a("pager",{attrs:{"last-page":t.lastPage,page:t.page},on:{change:function(e){return t.goTo(e)}}}),t._v(" "),t.showSiteForm?a("site-form",{attrs:{site:t.site,groupURL:""},on:{close:t.closeForm,create:function(e){return t.siteCreated(e)},update:function(e){return t.siteUpdated(e)}}}):t._e()],1)}),[],!1,null,"05f8d3d1",null);e.a=m.exports},yJCx:function(t,e,a){"use strict";var s={name:"Pager",props:{lastPage:{required:!0,type:Number},page:{required:!0,type:Number}},methods:{previous:function(){1!==this.page&&this.$emit("change",this.page-1)},next:function(){this.lastPage!==this.page&&this.$emit("change",this.page+1)},change:function(t){this.page!==t&&this.$emit("change",t)}}},n=a("KHd+"),r=Object(n.a)(s,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.lastPage>1?a("nav",{attrs:{"aria-label":"Page navigation"}},[a("ul",{staticClass:"pagination justify-content-center mb-0"},[a("li",{class:["page-item",{disabled:1===t.page}]},[a("a",{staticClass:"page-link",attrs:{href:"#",tabindex:"-1","aria-disabled":1===t.page?"true":"false"},on:{click:function(e){return e.preventDefault(),t.previous()}}},[t._v("Previous")])]),t._v(" "),t._l(t.lastPage,(function(e){return a("li",{class:["page-item",{active:t.page===e}]},[a("a",{staticClass:"page-link",attrs:{href:"#"},on:{click:function(a){return a.preventDefault(),t.change(e)}}},[t._v(t._s(e))])])})),t._v(" "),a("li",{class:["page-item",{disabled:t.lastPage===t.page}]},[a("a",{staticClass:"page-link",attrs:{href:"#","aria-disabled":t.lastPage===t.page?"true":"false"},on:{click:function(e){return e.preventDefault(),t.next()}}},[t._v("Next")])])],2)]):t._e()}),[],!1,null,"d369b0ee",null);e.a=r.exports}}]);